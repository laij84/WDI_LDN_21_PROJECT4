function setupInteceptor(e){return e.interceptors.push("AuthInterceptor")}function Router(e,t){e.state("home",{url:"/",templateUrl:"templates/home.html"}).state("register",{url:"/register",templateUrl:"templates/register.html",controller:"RegisterController as register"}).state("login",{url:"/login",templateUrl:"templates/login.html",controller:"LoginController as login"}),t.otherwise("/")}function LoginController(e,t,o){this.credentials={},this.submit=function(){this.form.$valid&&e.login(this.credentials,function(e){o.$broadcast("loggedIn"),t.go("home")})}}function MainController(e,t,o){var r=this;this.currentUser=e.decodeToken(),this.logout=function(){e.clearToken(),this.currentUser=null,t.go("home")},o.$on("loggedIn",function(){r.currentUser=e.decodeToken()}),o.$on("unauthorized",function(){r.errorMessage="You must be logged in!",t.go("login")})}function RegisterController(e,t,o){this.user={},this.submit=function(){e.register(this.user,function(e){o.$broadcast("loggedIn"),t.go("home")})}}function UsersController(e){this.all=e.query()}function User(e,t){return e(t+"/users",{id:"@_id"},{update:{method:"PUT"},login:{method:"POST",url:t+"/login"},register:{method:"POST",url:t+"/register"}})}function AuthInterceptor(e,t,o){return{request:function(o){var r=e.getToken();return o.url.match(t)&&r&&(o.headers.Authorization="Bearer "+r),o},response:function(o){return o.config.url.match(t)&&o.data.token&&e.setToken(o.data.token),o},responseError:function(e){return 401===e.status&&o.$broadcast("unauthorized"),e.data}}}function TokenService(e,t){this.setToken=function(t){return e.localStorage.setItem("token",t)},this.getToken=function(){return e.localStorage.getItem("token")},this.decodeToken=function(){var e=this.getToken();return e?t.decodeToken(e):null},this.clearToken=function(){return e.localStorage.removeItem("token")}}angular.module("HomeworkApp",["ui.router","ngResource","angular-jwt","ngMessages"]).constant("API_URL","http://localhost:3000/api").config(Router).config(setupInteceptor),setupInteceptor.$inject=["$httpProvider"],Router.$inject=["$stateProvider","$urlRouterProvider"],angular.module("HomeworkApp").controller("LoginController",LoginController),LoginController.$inject=["User","$state","$rootScope"],angular.module("HomeworkApp").controller("MainController",MainController),MainController.$inject=["TokenService","$state","$rootScope"],angular.module("HomeworkApp").controller("RegisterController",RegisterController),RegisterController.$inject=["User","$state","$rootScope"],angular.module("HomeworkApp").controller("UsersController",UsersController),UsersController.$inject=["User"],angular.module("HomeworkApp").factory("User",User),User.$inject=["$resource","API_URL"],angular.module("HomeworkApp").factory("AuthInterceptor",AuthInterceptor),AuthInterceptor.$inject=["TokenService","API_URL","$rootScope"],angular.module("HomeworkApp").service("TokenService",TokenService),TokenService.$inject=["$window","jwtHelper"];